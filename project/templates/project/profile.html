{% extends 'project/base.html' %}

{% block title %}Profile - {{ user.username }}{% endblock %}

{% block content %}
<h1>Profile</h1>

{% if messages %}
<div class="messages">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }}">
        {{ message }}
    </div>
    {% endfor %}
</div>
{% endif %}

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
    <!-- Profile Information Section -->
    <div>
        <h2>Profile Information</h2>
        
        {% if user.profile_pic %}
        <div style="margin-bottom: 1rem;">
            <img src="{{ user.profile_pic.url }}" alt="Profile Picture" style="max-width: 200px; border-radius: 8px;">
        </div>
        {% endif %}
        
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="profile">
            
            <label for="id_username">Username:</label>
            <input type="text" id="id_username" value="{{ user.username }}" disabled>
            <small>Username cannot be changed</small>
            
            <label for="{{ profile_form.first_name.id_for_label }}">First Name:</label>
            {{ profile_form.first_name }}
            {% if profile_form.first_name.errors %}
                <small style="color: red;">{{ profile_form.first_name.errors }}</small>
            {% endif %}
            
            <label for="{{ profile_form.last_name.id_for_label }}">Last Name:</label>
            {{ profile_form.last_name }}
            {% if profile_form.last_name.errors %}
                <small style="color: red;">{{ profile_form.last_name.errors }}</small>
            {% endif %}
            
            <label for="{{ profile_form.email.id_for_label }}">Email:</label>
            {{ profile_form.email }}
            {% if profile_form.email.errors %}
                <small style="color: red;">{{ profile_form.email.errors }}</small>
            {% endif %}
            
            <label for="{{ profile_form.bio.id_for_label }}">Bio:</label>
            {{ profile_form.bio }}
            {% if profile_form.bio.errors %}
                <small style="color: red;">{{ profile_form.bio.errors }}</small>
            {% endif %}
            
            <label for="{{ profile_form.profile_pic.id_for_label }}">Profile Picture:</label>
            {{ profile_form.profile_pic }}
            {% if profile_form.profile_pic.errors %}
                <small style="color: red;">{{ profile_form.profile_pic.errors }}</small>
            {% endif %}
            {% if user.profile_pic %}
                <small>Current: <a href="{{ user.profile_pic.url }}" target="_blank">{{ user.profile_pic.name }}</a></small>
            {% endif %}
            
            <button type="submit">Update Profile</button>
        </form>
    </div>

    <!-- Password Change Section -->
    <div>
        <h2>Change Password</h2>
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="password">
            
            <label for="{{ password_form.old_password.id_for_label }}">Current Password:</label>
            {{ password_form.old_password }}
            {% if password_form.old_password.errors %}
                <small style="color: red;">{{ password_form.old_password.errors }}</small>
            {% endif %}
            
            <label for="{{ password_form.new_password1.id_for_label }}">New Password:</label>
            {{ password_form.new_password1 }}
            {% if password_form.new_password1.errors %}
                <small style="color: red;">{{ password_form.new_password1.errors }}</small>
            {% endif %}
            
            <label for="{{ password_form.new_password2.id_for_label }}">Confirm New Password:</label>
            {{ password_form.new_password2 }}
            {% if password_form.new_password2.errors %}
                <small style="color: red;">{{ password_form.new_password2.errors }}</small>
            {% endif %}
            
            {% if password_form.non_field_errors %}
                <div style="color: red;">{{ password_form.non_field_errors }}</div>
            {% endif %}
            
            <button type="submit">Change Password</button>
        </form>
        
        <div style="margin-top: 1.5rem; padding: 1rem; background: var(--background-color, #f5f5f5); border-radius: 8px;">
            <h3 style="margin-top: 0;">Password Requirements</h3>
            <ul style="margin: 0;">
                <li>Your password can't be too similar to your other personal information.</li>
                <li>Your password must contain at least 8 characters.</li>
                <li>Your password can't be a commonly used password.</li>
                <li>Your password can't be entirely numeric.</li>
            </ul>
        </div>
    </div>
</div>

<style>
    @media (max-width: 768px) {
        div[style*="grid-template-columns"] {
            grid-template-columns: 1fr !important;
        }
    }
    .messages {
        margin-bottom: 1rem;
    }
    .alert {
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 0.5rem;
    }
    .alert-success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }
    .alert-error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }
</style>

{% endblock %}
