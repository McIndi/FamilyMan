{% load static week_start %}
<!DOCTYPE html>
<html>
<head>
    <title>{% block title %}FamilyMan{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{% static 'css/pico.classless.min.css' %}">
    <style>
        .top-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }
        .top-nav ul {
            display: flex;
            align-items: center;
            gap: 1rem;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .top-nav .nav-right {
            margin-left: auto;
        }
        @media (max-width: 1100px) {
            .top-nav {
                flex-wrap: wrap;
                row-gap: 0.75rem;
            }
            .top-nav .nav-right {
                margin-left: 0;
            }
        }
        @media (max-width: 1100px) {
            body {
                font-size: 1.1rem;
                line-height: 1.5;
            }
            h1 {
                font-size: 1.9rem;
            }
            h2 {
                font-size: 1.5rem;
            }
            h3 {
                font-size: 1.25rem;
            }
            button,
            input,
            select,
            textarea {
                font-size: 1.05rem;
            }
            .top-nav a {
                font-size: 1.05rem;
            }
        }
        /* Profile picture styles */
        .profile-pic {
            border-radius: 50%;
            object-fit: cover;
            vertical-align: middle;
        }
        .profile-pic-tiny {
            width: 24px;
            height: 24px;
        }
        .profile-pic-small {
            width: 40px;
            height: 40px;
        }
        .profile-pic-medium {
            width: 60px;
            height: 60px;
        }
        .profile-pic-default {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: var(--primary, #4CAF50);
            color: white;
            font-weight: bold;
            vertical-align: middle;
        }
        .profile-container {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
    </style>
    <!-- <link rel="stylesheet" href="https://classless.de/classless.css"> -->
    <!-- <link rel="stylesheet" href="https://classless.de/classless-tiny.css"> -->
    <!-- <link rel="stylesheet" href="https://cdn.simplecss.org/sim ple.min.css"> -->
    {% block extra_head %}{% endblock %}
</head>
<body>
    <nav class="top-nav">
        <ul class="nav-left">
            <li class="float-left"><a href="{% url 'landing_page' %}">Home</a></li>
            <li><a href="{% url 'item_list' %}">Shopping List</a></li>
            {% week_start as week_start_date %}
            <li><a href="{% url 'week_view' week_start_date.year week_start_date.month week_start_date.day %}">Calendar</a></li>
            <li><a href="{% url 'inbox' %}">Inbox</a></li>
            <li><a href="{% url 'merit_dashboard' %}">Merits</a></li>
            <li><a href="{% url 'family_dashboard' %}">Family</a></li>
            {% if request.current_family_role != 'child' %}
            <li><a href="{% url 'cash_transaction_list' %}">Cash</a></li>
            {% endif %}
        </ul>
        <ul class="nav-right">
            <li>
                <label style="display: inline-flex; align-items: center; gap: 0.5rem;">
                    <input id="theme-toggle" type="checkbox" role="switch" aria-label="Toggle dark mode">
                    Dark Mode
                </label>
            </li>
            {% if user.is_authenticated %}
                <li>
                    <a href="{% url 'profile' %}" class="profile-container">
                        {% if user.profile_pic %}
                            <img src="{{ user.profile_pic.url }}" alt="{{ user.username }}" class="profile-pic profile-pic-tiny">
                        {% else %}
                            <span class="profile-pic-default profile-pic-tiny">{{ user.username|slice:":1"|upper }}</span>
                        {% endif %}
                        Profile
                    </a>
                </li>
                <li>
                    <form method="post" action="{% url 'logout' %}" style="display: inline;">
                        {% csrf_token %}
                        <button type="submit" style="background: none; border: none; color: inherit; cursor: pointer;">Logout</button>
                    </form>
                </li>
                <li>
                    <form method="post" action="{% url 'switch_family' %}" style="display: inline;">
                        {% csrf_token %}
                        <select name="family_id" onchange="this.form.submit()">
                            {% for family in user.families.all %}
                            <option value="{{ family.id }}" {% if family == request.current_family %}selected{% endif %}>
                                {{ family.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </form>
                </li>
            {% else %}
                <li><a href="{% url 'login' %}">Login</a></li>
                <li><a href="{% url 'signup' %}">Sign Up</a></li>
            {% endif %}
        </ul>
    </nav>
    {% if messages %}
    <ul class="messages">
        {% for message in messages %}
        <li class="{{ message.tags }}">{{ message }}</li>
        {% endfor %}
    </ul>
    {% endif %}
    <main>
        {% block content %}{% endblock %}
    </main>
    <script>
        (function () {
            var storageKey = "theme";
            var root = document.documentElement;
            var toggle = document.getElementById("theme-toggle");

            if (!toggle) {
                return;
            }

            function applyTheme(theme) {
                if (theme === "dark" || theme === "light") {
                    root.setAttribute("data-theme", theme);
                    toggle.checked = theme === "dark";
                } else {
                    root.removeAttribute("data-theme");
                    toggle.checked = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
                }
            }

            var savedTheme = null;
            try {
                savedTheme = localStorage.getItem(storageKey);
            } catch (err) {
                savedTheme = null;
            }

            applyTheme(savedTheme);

            toggle.addEventListener("change", function () {
                var nextTheme = toggle.checked ? "dark" : "light";
                root.setAttribute("data-theme", nextTheme);
                try {
                    localStorage.setItem(storageKey, nextTheme);
                } catch (err) {
                    // Ignore storage errors and keep the live theme change.
                }
            });
        })();
    </script>
</body>
</html>